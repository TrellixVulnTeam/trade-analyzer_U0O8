{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/benjaminshiao/Desktop/react/trade-analyzer/src/components/chart-components/Chart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport Candle from \"./Candle\";\nimport CrossHairs from \"./CrossHairs\";\nconst CSS = styled.div`\n  .caret{\n    font-size: 65%;\n  }\n\n  .priceChanges{\n    font-size: 80%;\n  }\n`;\n_c = CSS;\n\nconst Chart = props => {\n  _s();\n\n  const {\n    data,\n    graph_type,\n    width: chart_width,\n    height: chart_height\n  } = props; // let { last_bar_idx = 0, bars_wide = 40 } = props;\n  // last_bar_idx should default to the last bar in the data, or else be sure passed-in value doesn't exceed the last bar\n  // last_bar_idx = last_bar_idx > 0 ? Math.min(last_bar_idx, data.length - 1) : data.length - 1;\n\n  const [mouseCoords, setMouseCoords] = useState({\n    x: -50,\n    y: -50\n  }); // let mouseCoords = {\n  //   x: 0,\n  //   y: 0\n  // };\n  // const setMouseCoords = (x, y) => {\n  //   mouseCoords = { x, y };\n  // };\n  // find the high and low bounds of all the bars being sidplayed\n\n  const dollar_high = Math.max.apply(Math, data.map(bar => +bar.high)) * 1.15;\n  const dollar_low = Math.min.apply(Math, data.map(bar => +bar.low)) * 0.95; // calculate the candle width\n\n  const candle_width = Math.floor(chart_width / data.length * 0.7);\n  console.log(candle_width);\n  const chart_dims = {\n    pixel_width: chart_width,\n    pixel_height: chart_height,\n    dollar_high,\n    dollar_low,\n    dollar_delta: dollar_high - dollar_low\n  }; // toFixed rounds number to 2 decimal places\n\n  const dollarAt = pixel => {\n    const dollar = Math.abs(pixel - chart_dims.pixel_height) / chart_dims.pixel_height * chart_dims.dollar_delta + chart_dims.dollar_low;\n    return pixel > 0 ? dollar.toFixed(2) : \"-\";\n  }; // Gets candlestick data at x position\n\n\n  const candleDataAt = pixel => {\n    if (pixel <= 0 || pixel >= chart_dims.pixel_width) return \"-\";\n    const candle = data[Math.floor(pixel / chart_dims.pixel_width * data.length)];\n    return candle;\n  };\n\n  const convertDate = dateString => {\n    if (!dateString) return \"\";\n    const myYear = dateString.substring(2, 4);\n    const myMonth = parseInt(dateString.substring(5, 7), 10);\n    const myDay = parseInt(dateString.substring(8, 10), 10);\n\n    if (dateString.length === 10) {\n      return myMonth + \"/\" + myDay + \"/\" + myYear;\n    }\n\n    const myHour = parseInt(dateString.substring(11, 13), 10);\n    const myMinute = dateString.substring(14, 16);\n    return myMonth + \"/\" + myDay + \"/\" + myYear + \" \" + myHour + \":\" + myMinute + \" EST\";\n  };\n\n  const candleChange = pixel => {\n    if (pixel <= 0 || pixel >= chart_dims.pixel_width) return \"blank\";\n    const candle = data[Math.floor(pixel / chart_dims.pixel_width * data.length)];\n    const change = (candle['close'] / candle['open'] - 1) * 100;\n    const posNeg = change > 0 ? '+' : '-';\n    return posNeg + Math.abs(change).toFixed(2);\n  };\n\n  const pixelFor = dollar => {\n    return (dollar - chart_dims[\"dollar_low\"]) / chart_dims[\"dollar_delta\"] * chart_dims[\"pixel_height\"] - chart_dims[\"pixel_height\"];\n  };\n\n  const onMouseLeave = () => {\n    setMouseCoords({\n      x: -50,\n      y: -50\n    });\n  };\n\n  const onMouseMoveInside = e => {\n    //for date(x axis), calc using dates[x cord/width] , create dates[]\n    setMouseCoords({\n      x: e.nativeEvent.x - Math.round(e.currentTarget.getBoundingClientRect().left),\n      y: e.nativeEvent.y - Math.round(e.currentTarget.getBoundingClientRect().top)\n    });\n  };\n\n  const onMouseClickInside = e => {\n    console.log(`Click at ${e.nativeEvent.offsetX}, ${e.nativeEvent.offsetY}`);\n  }; // Returns string for mouse off chart display\n\n\n  const graphTypeStr = () => {\n    switch (graph_type) {\n      case 'day':\n        return \"Yesterday\";\n\n      case 'week':\n        return \"Past Week\";\n\n      case 'month':\n        return \"Past Month\";\n\n      case 'quarter':\n        return \"Past 3 Months\";\n\n      case 'year':\n        return \"Past Year\";\n\n      default:\n        return \"Error chart.js\";\n    }\n  }; // Return JSX for mouse off chart display\n\n\n  const mouseOffChartJSX = () => {\n    if (data.length < 3) return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n\n    const englishStr = /*#__PURE__*/_jsxDEV(\"tspan\", {\n      fill: \"#898996\",\n      children: graphTypeStr()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 24\n    }, this);\n\n    const changePercent = (data[data.length - 1][\"close\"] / data[0][\"open\"] - 1) * 100;\n    const changeUSD = data[data.length - 1][\"close\"] - data[0][\"open\"];\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"tspan\", {\n        className: \"\",\n        fill: \"#dedfe4\",\n        children: [\"$\", data[data.length - 1][\"close\"], \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"tspan\", {\n        className: \"caret\",\n        fill: changeUSD >= 0 ? \"#81dfc4\" : \"#d75b6d\",\n        children: [changeUSD >= 0 ? \"▲\" : \"▼\", \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"tspan\", {\n        className: \"priceChanges\",\n        fill: changeUSD >= 0 ? \"#81dfc4\" : \"#d75b6d\",\n        children: [\" $\", Math.abs(changeUSD).toFixed(2), \" (\", changePercent.toFixed(2), \"%) \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }, this), englishStr]\n    }, void 0, true);\n  };\n\n  return /*#__PURE__*/_jsxDEV(CSS, {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      width: chart_width * 1.025\n      /* Extra width to fit price */\n      ,\n      height: chart_height,\n      className: \"chart\",\n      onMouseMove: onMouseMoveInside,\n      onClick: onMouseClickInside,\n      onMouseLeave: onMouseLeave,\n      children: [data.map((bar, i) => {\n        const candle_x = chart_width / (data.length + 1) * (i + 1);\n        return /*#__PURE__*/_jsxDEV(Candle, {\n          data: bar,\n          x: candle_x,\n          candle_width: candle_width,\n          pixelFor: pixelFor\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 11\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(CrossHairs, {\n        x: mouseCoords.x,\n        y: mouseCoords.y,\n        chart_dims: chart_dims\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 7\n      }, this), mouseCoords.x > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"rect\", {\n          x: chart_width * 1.025 - (1 + dollarAt(mouseCoords.y).length) * 10,\n          y: mouseCoords.y - 12,\n          width: (1 + dollarAt(mouseCoords.y).length) * 10,\n          height: \"25\",\n          fill: \"white\",\n          rx: \"9\",\n          ry: \"9\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: 5 + chart_width * 1.025 - (1 + dollarAt(mouseCoords.y).length) * 10,\n          y: mouseCoords.y + 5,\n          fill: \"black\",\n          fontSize: \"15\",\n          children: [\"$\", dollarAt(mouseCoords.y)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: \"16\",\n          y: \"30\",\n          fontSize: \"20\",\n          children: [/*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"Open\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#dedfe4\",\n            children: [\"$\", candleDataAt(mouseCoords.x)['open'], \"  \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 44\n          }, this), /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"High\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#dedfe4\",\n            children: [\"$\", candleDataAt(mouseCoords.x)['high']]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 44\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: \"16\",\n          y: \"54\",\n          fontSize: \"20\",\n          children: [/*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#dedfe4\",\n            children: [\"$\", candleDataAt(mouseCoords.x)['close'], \"  \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 45\n          }, this), /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"Low\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#dedfe4\",\n            children: [\"$\", candleDataAt(mouseCoords.x)['low']]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: \"16\",\n          y: \"76\",\n          fontSize: \"20\",\n          children: [/*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"Volume\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#dedfe4\",\n            children: [mouseCoords.x > 0 ? (candleDataAt(mouseCoords.x)['volume'] / 1000).toFixed(2) + 'K' : '', \"  \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 46\n          }, this), /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: \"#898996\",\n            children: \"Change\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 9\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"tspan\", {\n            fill: candleChange(mouseCoords.x) >= 0 ? \"#81dfc4\" : \"#d75b6d\",\n            children: [candleChange(mouseCoords.x), \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 46\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 7\n        }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n          x: \"16\",\n          y: \"110\",\n          fill: \"#898996\",\n          fontSize: \"30\",\n          children: convertDate(candleDataAt(mouseCoords.x)['xAxis'])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 7\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"text\", {\n        x: \"16\",\n        y: \"40\",\n        fontSize: \"35\",\n        children: mouseOffChartJSX()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 158,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Chart, \"Zirphik+dq5A1HSKq0DCW4tQD+A=\");\n\n_c2 = Chart;\nexport default Chart;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CSS\");\n$RefreshReg$(_c2, \"Chart\");","map":{"version":3,"sources":["/Users/benjaminshiao/Desktop/react/trade-analyzer/src/components/chart-components/Chart.js"],"names":["React","useState","styled","Candle","CrossHairs","CSS","div","Chart","props","data","graph_type","width","chart_width","height","chart_height","mouseCoords","setMouseCoords","x","y","dollar_high","Math","max","apply","map","bar","high","dollar_low","min","low","candle_width","floor","length","console","log","chart_dims","pixel_width","pixel_height","dollar_delta","dollarAt","pixel","dollar","abs","toFixed","candleDataAt","candle","convertDate","dateString","myYear","substring","myMonth","parseInt","myDay","myHour","myMinute","candleChange","change","posNeg","pixelFor","onMouseLeave","onMouseMoveInside","e","nativeEvent","round","currentTarget","getBoundingClientRect","left","top","onMouseClickInside","offsetX","offsetY","graphTypeStr","mouseOffChartJSX","englishStr","changePercent","changeUSD","i","candle_x"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport styled from \"styled-components\";\n\nimport Candle from \"./Candle\";\nimport CrossHairs from \"./CrossHairs\";\n\nconst CSS = styled.div`\n  .caret{\n    font-size: 65%;\n  }\n\n  .priceChanges{\n    font-size: 80%;\n  }\n`;\n\nconst Chart = props => {\n  const { data, graph_type, width: chart_width, height: chart_height } = props;\n  // let { last_bar_idx = 0, bars_wide = 40 } = props;\n\n  // last_bar_idx should default to the last bar in the data, or else be sure passed-in value doesn't exceed the last bar\n  // last_bar_idx = last_bar_idx > 0 ? Math.min(last_bar_idx, data.length - 1) : data.length - 1;\n\n  const [mouseCoords, setMouseCoords] = useState({\n    x: -50,\n    y: -50\n  });\n\n  // let mouseCoords = {\n  //   x: 0,\n  //   y: 0\n  // };\n\n  // const setMouseCoords = (x, y) => {\n  //   mouseCoords = { x, y };\n  // };\n\n  // find the high and low bounds of all the bars being sidplayed\n  const dollar_high = Math.max.apply(Math, data.map(bar => +bar.high)) * 1.15;\n  const dollar_low = Math.min.apply(Math, data.map(bar => +bar.low)) * 0.95 ;\n\n  // calculate the candle width\n  const candle_width = Math.floor((chart_width / data.length) * 0.7);\n  console.log(candle_width);\n\n  const chart_dims = {\n    pixel_width: chart_width,\n    pixel_height: chart_height,\n    dollar_high,\n    dollar_low,\n    dollar_delta: dollar_high - dollar_low\n  };\n\n  // toFixed rounds number to 2 decimal places\n  const dollarAt = pixel => {\n    const dollar =\n      (Math.abs(pixel - chart_dims.pixel_height) / chart_dims.pixel_height) *\n        chart_dims.dollar_delta +\n      chart_dims.dollar_low;\n\n    return pixel > 0 ? dollar.toFixed(2) : \"-\";\n  };\n\n  // Gets candlestick data at x position\n  const candleDataAt = pixel => {\n    if(pixel<=0 || pixel >= chart_dims.pixel_width) return \"-\";\n    const candle = data[Math.floor((pixel/ chart_dims.pixel_width) * data.length)];\n\n    return candle;\n  };\n\n  const convertDate = dateString => {\n    if(!dateString) return \"\";\n    const myYear = dateString.substring(2,4);\n    const myMonth = parseInt(dateString.substring(5,7), 10);\n    const myDay = parseInt(dateString.substring(8,10), 10);\n    if(dateString.length===10){\n      return myMonth + \"/\" + myDay + \"/\" + myYear;\n    }\n    const myHour = parseInt(dateString.substring(11,13), 10);\n    const myMinute = dateString.substring(14,16);\n\n    return myMonth + \"/\" + myDay + \"/\" + myYear + \" \" + myHour + \":\" + myMinute + \" EST\";\n  }\n\n  const candleChange = pixel => {\n    if(pixel<=0 || pixel >= chart_dims.pixel_width) return \"blank\";\n    const candle = data[Math.floor((pixel/ chart_dims.pixel_width) * data.length)];\n    const change = ((candle['close']/candle['open'])-1) * 100;\n    const posNeg = change > 0 ? '+' : '-';\n    return posNeg + Math.abs(change).toFixed(2);\n  };\n\n  const pixelFor = dollar => {\n    return (\n      ((dollar - chart_dims[\"dollar_low\"]) / chart_dims[\"dollar_delta\"]) *\n        chart_dims[\"pixel_height\"] -\n        chart_dims[\"pixel_height\"]\n    );\n  };\n\n  const onMouseLeave = () => {\n    setMouseCoords({\n      x: -50,\n      y: -50\n    });\n  };\n\n  const onMouseMoveInside = e => {\n    //for date(x axis), calc using dates[x cord/width] , create dates[]\n    setMouseCoords({\n      x:\n        e.nativeEvent.x -\n        Math.round(e.currentTarget.getBoundingClientRect().left),\n      y:\n        e.nativeEvent.y -\n        Math.round(e.currentTarget.getBoundingClientRect().top)\n    });\n  };\n\n  const onMouseClickInside = e => {\n    console.log(`Click at ${e.nativeEvent.offsetX}, ${e.nativeEvent.offsetY}`);\n  };\n\n  // Returns string for mouse off chart display\n  const graphTypeStr = () => {\n    switch(graph_type){\n      case 'day':\n        return \"Yesterday\";\n      case 'week':\n        return \"Past Week\";\n      case 'month':\n        return \"Past Month\";\n      case 'quarter':\n        return \"Past 3 Months\";\n      case 'year':\n        return \"Past Year\";\n      default:\n        return \"Error chart.js\";\n    }\n  };\n\n  // Return JSX for mouse off chart display\n  const mouseOffChartJSX = () => {\n    if(data.length<3) return <></>;\n    const englishStr = <tspan fill='#898996'>{graphTypeStr()}</tspan>;\n    const changePercent = ((data[data.length-1][\"close\"] / data[0][\"open\"]) - 1) * 100 ;\n    const changeUSD = data[data.length-1][\"close\"] - data[0][\"open\"];\n    return <>\n      <tspan className=\"\" fill=\"#dedfe4\">${data[data.length-1][\"close\"]} </tspan>\n      <tspan className=\"caret\" fill={changeUSD>=0?\"#81dfc4\":\"#d75b6d\"}>{changeUSD>=0?\"▲\":\"▼\"} </tspan>\n      <tspan className=\"priceChanges\" fill={changeUSD>=0?\"#81dfc4\":\"#d75b6d\"}> ${Math.abs(changeUSD).toFixed(2)} ({changePercent.toFixed(2)}%) </tspan>\n      {englishStr}\n    </>;\n  }\n\n  return (\n    <CSS>\n    <svg\n      width={chart_width*1.025 /* Extra width to fit price */}\n      height={chart_height}\n      className=\"chart\"\n      onMouseMove={onMouseMoveInside}\n      onClick={onMouseClickInside}\n      onMouseLeave={onMouseLeave}\n    >\n      {data.map((bar, i) => {\n        const candle_x = (chart_width / (data.length + 1)) * (i + 1);\n        return (\n          <Candle\n            key={i}\n            data={bar}\n            x={candle_x}\n            candle_width={candle_width}\n            pixelFor={pixelFor}\n          />\n        );\n      })}\n\n      <CrossHairs x={mouseCoords.x} y={mouseCoords.y} chart_dims={chart_dims} />\n      {mouseCoords.x>0 ? <> \n      {/* Price */}\n      <rect x={(chart_width*1.025)-(1+dollarAt(mouseCoords.y).length)*10} y={mouseCoords.y-12} width={(1+dollarAt(mouseCoords.y).length)*10} height='25' fill=\"white\" rx='9' ry='9'>{/* background color for price */}</rect>\n      <text x={5 + (chart_width*1.025)-(1+dollarAt(mouseCoords.y).length)*10} y={mouseCoords.y+5} fill='black' fontSize=\"15\">\n        ${dollarAt(mouseCoords.y)}\n      </text>\n      {/* Open/High */}\n      <text x='16' y='30' fontSize=\"20\">\n        <tspan fill='#898996'>Open</tspan> <tspan fill='#dedfe4'>${candleDataAt(mouseCoords.x)['open']}  </tspan>\n        <tspan fill='#898996'>High</tspan> <tspan fill='#dedfe4'>${candleDataAt(mouseCoords.x)['high']}</tspan>\n      </text>\n      {/* Low/Close */}\n      <text x='16' y='54' fontSize=\"20\">\n        <tspan fill='#898996'>Close</tspan> <tspan fill='#dedfe4'>${candleDataAt(mouseCoords.x)['close']}  </tspan>\n        <tspan fill='#898996'>Low</tspan> <tspan fill='#dedfe4'>${candleDataAt(mouseCoords.x)['low']}</tspan>\n      </text>\n      {/* Volume/%change */}\n      <text x='16' y='76' fontSize=\"20\">\n        <tspan fill='#898996'>Volume</tspan> <tspan fill='#dedfe4'>{mouseCoords.x > 0 ?(candleDataAt(mouseCoords.x)['volume']/1000).toFixed(2) + 'K': ''}  </tspan>\n        <tspan fill='#898996'>Change</tspan> <tspan fill={candleChange(mouseCoords.x)>=0?\"#81dfc4\":\"#d75b6d\"}>{candleChange(mouseCoords.x)}%</tspan>\n      </text>\n      {/* Date Time */}\n      <text x='16' y='110' fill='#898996' fontSize='30'>\n        {convertDate(candleDataAt(mouseCoords.x)['xAxis'])} \n      </text>\n      </> : <text x='16' y='40' fontSize=\"35\">{mouseOffChartJSX()}</text>}\n      \n    </svg>\n    </CSS>\n  );\n};\n\nexport default Chart;\n"]},"metadata":{},"sourceType":"module"}